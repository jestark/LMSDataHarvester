<?xml version="1.0" encoding="UTF-8" ?>
<entity-mappings xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm"
				 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence/orm
									 http://xmlns.jcp.org/xml/ns/persistence/orm_2_1.xsd"
				 version="2.1">
	<description>Entity mappings for the moodle database</description>
	<package>ca.uoguelph.socs.icc.moodleapi</package>

	<access>PROPERTY</access>

	<!-- Map the Abstract classes here, to save mapping their attributes later -->

	<mapped-superclass class="AbstractActivity" metadata-complete="true">
		<description>Mapping for ID attribute for all activities</description>
		<attributes>
			<id name="id">
				<column name="id"/>
			</id>
		</attributes>
	</mapped-superclass>

	<mapped-superclass class="AbstractNamedActivity" metadata-complete="true">
		<description>Default mapping for Name attribute for all activities</description>
		<attributes>
			<basic name="name">
				<column name="name"/>
			</basic>
		</attributes>
	</mapped-superclass>

	<entity name="GenericNamedActivity" class="GenericNamedActivity" metadata-complete="true">
		<description>Mapping For the Generic Activity and the relationship the the instance</description>
		<inheritance strategy="TABLE_PER_CLASS"/>
		<attributes>
			<transient name="instance"/><!--<one-to-one name="instance" mapped-by="activity"/>-->
			<transient name="course"/>
			<transient name="type"/>
			<transient name="gradable"/>
			<transient name="stealth"/>
			<transient name="grades"/>
		</attributes>
	</entity>

	<!-- Note:  Abstract Group classes are deliberatly not mapped.  The Generics used in the
	classes confuse the mapper.  So all of the parent-child relations must be mapped by the
	implementation classes, where the relationships are fully defined. -->

	<entity name="ActivityType" class="ActivityType" metadata-complete="true">
		<description>Mapping definition for the Activity Types (Moodle modules)</description>
		<table name="mdl_modules"/>
		<attributes>
			<id name="id">
				<column name="id"/>
			</id>
			<basic name="name">
				<column name="name"/>
			</basic>
			<transient name="actions"/>
		</attributes>
	</entity>

	<entity name="ActivityInstance" class="ActivityInstance" metadata-complete="true">
		<description>Mapping definition for the instances of the activities</description>
		<table name="mdl_course_modules"/>
		<attributes>
			<many-to-one name="course" fetch="LAZY">
				<join-column name="course"/>
			</many-to-one>
			<many-to-one name="type" fetch="LAZY">
				<join-column name="module"/>
			</many-to-one>
			<!--			<one-to-one name="activity" target-entity="GenericNamedActivity" fetch="LAZY">
			<join-column name="instance"/>
			</one-to-one>-->
			<transient name="activity"/>
			<transient name="gradable"/>
			<transient name="stealth"/>
			<transient name="grades"/>
			<transient name="name"/>
		</attributes>
	</entity>

	<entity name="Course" class="Course" metadata-complete="true">
		<description>Mapping definition for the Courses</description>
		<table name="mdl_course"/>
		<attributes>
			<id name="id">
				<column name="id" insertable="false" updatable="false"/>
			</id>
			<basic name="name">
				<column name="fullname" insertable="false" updatable="false"/>
			</basic>
			<basic name="semester">
				<column name="startdate" insertable="false" updatable="false"/>
				<convert converter="SemesterConverter"/>
			</basic>
			<basic name="year">
				<column name="startdate" insertable="false" updatable="false"/>
				<convert converter="MoodleDateYearConverter"/>
			</basic>
			<one-to-many name="activities" mapped-by="course"/>
			<!--<one-to-many name="enrolments" mapped-by="course"/>
			<one-to-many name="log" target-entity="MoodleDBLogEntry" mapped-by="course">
				<order-by>id</order-by>
			</one-to-many>-->
			<transient name="enrolments"/>
			<transient name="log"/>
		</attributes>
	</entity>


	<!-- Moodle Grouped Activity Implmentation Classes -->


	<entity name="MoodleBookActivity" class="MoodleBookActivity" metadata-complete="true">
		<table name="mdl_book"/>
		<attributes>
			<one-to-many name="children" mapped-by="parent"/>
		</attributes>
	</entity>

	<entity name="MoodleBookActivityChapter" class="MoodleBookActivityChapter" metadata-complete="true">
		<table name="mdl_book_chapters"/>
		<attributes>
			<basic name="name">
				<column name="title"/>
			</basic>
			<many-to-one name="parent">
				<join-column name="bookid"/>
			</many-to-one>
		</attributes>
	</entity>

	<entity name="MoodleForumActivity" class="MoodleForumActivity" metadata-complete="true">
		<table name="mdl_forum"/>
		<attributes>
			<one-to-many name="children" mapped-by="parent"/>
		</attributes>
	</entity>

	<entity name="MoodleForumActivityDiscussion" class="MoodleForumActivityDiscussion" metadata-complete="true">
		<table name="mdl_forum_discussions"/>
		<attributes>
			<many-to-one name="parent">
				<join-column name="forum"/>
			</many-to-one>
			<one-to-many name="children" mapped-by="parent"/>
		</attributes>
	</entity>

	<entity name="MoodleForumActivityPost" class="MoodleForumActivityPost" metadata-complete="true">
		<table name="mdl_forum_posts"/>
		<attributes>
			<basic name="name">
				<column name="subject"/>
			</basic>
			<many-to-one name="parent">
				<join-column name="discussion"/>
			</many-to-one>
		</attributes>
	</entity>

	<entity name="MoodleLessonActivity" class="MoodleLessonActivity" metadata-complete="true">
		<table name="mdl_lesson"/>
		<attributes>
			<one-to-many name="children" mapped-by="parent"/>
		</attributes>
	</entity>

	<entity name="MoodleLessonActivityPage" class="MoodleLessonActivityPage" metadata-complete="true">
		<table name="mdl_lesson_pages"/>
		<attributes>
			<basic name="name">
				<column name="title"/>
			</basic>
			<many-to-one name="parent">
				<join-column name="lessonid"/>
			</many-to-one>
		</attributes>
	</entity>

	<entity name="MoodleWorkshopActivity" class="MoodleWorkshopActivity" metadata-complete="true">
		<table name="mdl_workshop"/>
		<attributes>
			<one-to-many name="children" mapped-by="parent"/>
		</attributes>
	</entity>

	<entity name="MoodleWorkshopActivitySubmission" class="MoodleWorkshopActivitySubmission" metadata-complete="true">
		<table name="mdl_workshop_submissions"/>
		<attributes>
			<basic name="name">
				<column name="title"/>
			</basic>
			<many-to-one name="parent">
				<join-column name="workshopid"/>
			</many-to-one>
		</attributes>
	</entity>


	<!-- Moodle Named Activity Implmentation Classes -->


	<entity name="MoodleAssignActivity" class="MoodleAssignActivity" metadata-complete="true">
		<table name="mdl_assign"/>
	</entity>

	<entity name="MoodleChecklistActivity" class="MoodleChecklistActivity" metadata-complete="true">
		<table name="mdl_checklist"/>
	</entity>

	<entity name="MoodleChoiceActivity" class="MoodleChoiceActivity" metadata-complete="true">
		<table name="mdl_choice"/>
	</entity>

	<entity name="MoodleFeedbackActivity" class="MoodleFeedbackActivity" metadata-complete="true">
		<table name="mdl_feedback"/>
	</entity>

	<entity name="MoodleFolderActivity" class="MoodleFolderActivity" metadata-complete="true">
		<table name="mdl_folder"/>
	</entity>

	<entity name="MoodleLabelActivity" class="MoodleLabelActivity" metadata-complete="true">
		<table name="mdl_label"/>
	</entity>

	<entity name="MoodlePageActivity" class="MoodlePageActivity" metadata-complete="true">
		<table name="mdl_page"/>
	</entity>

	<entity name="MoodleQuizActivity" class="MoodleQuizActivity" metadata-complete="true">
		<table name="mdl_quiz"/>
	</entity>

	<entity name="MoodleResourceActivity" class="MoodleResourceActivity" metadata-complete="true">
		<table name="mdl_resource"/>
	</entity>

	<entity name="MoodleSchedulerActivity" class="MoodleSchedulerActivity" metadata-complete="true">
		<table name="mdl_scheduler"/>
	</entity>

	<entity name="MoodleURLActivity" class="MoodleURLActivity" metadata-complete="true">
		<table name="mdl_url"/>
	</entity>
</entity-mappings>