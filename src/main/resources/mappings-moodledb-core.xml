<?xml version="1.0" encoding="UTF-8" ?>
<entity-mappings xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm"
				 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence/orm
									 http://xmlns.jcp.org/xml/ns/persistence/orm_2_1.xsd"
				 version="2.1">
	<description>Entity mappings for the moodle database</description>
	<package>ca.uoguelph.socs.icc.edm.domain.element</package>

	<access>PROPERTY</access>

	<!--*********************************************************************-->
	<!--  Mapped super classes used by activities                            -->
	<!--*********************************************************************-->

	<!--	<mapped-superclass class="AbstractActivity" metadata-complete="true">
		<description></description>
		<attributes>
			<transient name="subActivities"/>
			<transient name="log"/>
		</attributes>
	</mapped-superclass>-->

	<mapped-superclass class="GenericSubActivity" metadata-complete="true">
		<description></description>
		<attributes>
			<basic name="name">
				<column name="name"/>
			</basic>
			<transient name="parent"/>
			<transient name="course"/>
			<transient name="type"/>
			<transient name="grades"/>
			<transient name="subActivities"/>
			<transient name="log"/>
		</attributes>
	</mapped-superclass>

	<mapped-superclass class="GenericNamedActivity" metadata-complete="true">
		<description>Mapping For the Generic Activity and the relationship the the instance</description>
		<attributes>
			<basic name="name">
				<column name="name"/>
			</basic>
			<transient name="subActivities"/>
			<transient name="log"/>
		</attributes>
	</mapped-superclass>

	<!--*********************************************************************-->
	<!-- Core data mapping: Users                                            -->
	<!--*********************************************************************-->

	<entity name="User" class="UserData" metadata-complete="true">
		<description>Mapping definition for the Users</description>
		<table name="mdl_user"/>
		<named-query name="UserData:maxid">
			<query>SELECT MAX(u.id) FROM User u</query>
		</named-query>
		<named-query name="UserData:allid">
			<query>SELECT u.id FROM User u</query>
		</named-query>
		<named-query name="UserData:all">
			<query>SELECT u FROM User u</query>
		</named-query>
		<named-query name="UserData:username">
			<query>SELECT u FROM User u where u.username = :username</query>
		</named-query>
		<named-query name="UserData:idnumber">
			<query>SELECT u FROM User u where u.idNumber = :idnumber</query>
		</named-query>
		<attributes>
			<id name="id">
				<column name="id" unique="true" nullable="false" insertable="false" updatable="false"/>
			</id>
			<basic name="idNumber">
				<column name="idnumber" insertable="false" updatable="false"/>
				<convert converter="ca.uoguelph.socs.icc.edm.domain.database.moodle.converter.IdNumberConverter"/>
			</basic>
			<basic name="username">
				<column name="username" nullable="false" insertable="false" updatable="false"/>
			</basic>
			<basic name="firstname">
				<column name="firstname" nullable="false" insertable="false" updatable="false"/>
			</basic>
			<basic name="lastname">
				<column name="lastname" nullable="false" insertable="false" updatable="false"/>
			</basic>
			<transient name="name"/>
			<transient name="enrolments"/>
		</attributes>
	</entity>

	<!--*********************************************************************-->
	<!-- Core data mapping: Courses                                          -->
	<!--*********************************************************************-->

	<entity name="Course" class="CourseData" metadata-complete="true">
		<description>Mapping definition for the Courses</description>
		<table name="mdl_course"/>
		<named-query name="CourseData:all">
			<query>SELECT c FROM Course c</query>
		</named-query>
		<attributes>
			<id name="id">
				<column name="id" nullable="false" insertable="false" updatable="false"/>
			</id>
			<basic name="name">
				<column name="fullname" insertable="false" updatable="false"/>
			</basic>
			<basic name="semester">
				<column name="startdate" insertable="false" updatable="false"/>
				<convert converter="ca.uoguelph.socs.icc.edm.domain.database.moodle.converter.SemesterConverter"/>
			</basic>
			<basic name="year">
				<column name="startdate" insertable="false" updatable="false"/>
				<convert converter="ca.uoguelph.socs.icc.edm.domain.database.moodle.converter.DateYearConverter"/>
			</basic>
			<one-to-many name="activities" target-entity="ca.uoguelph.socs.icc.edm.domain.database.moodle.MoodleActivity" mapped-by="course"/>
			<!--			<one-to-many name="enrolments" mapped-by="course"/>
			<one-to-many name="log" target-entity="MoodleDBLogEntry" mapped-by="course">
			<order-by>id</order-by>
			</one-to-many>-->
			<transient name="enrolments"/>
		</attributes>
	</entity>

	<!--*********************************************************************-->
	<!--  Core data mapping: Activities                                      -->
	<!--*********************************************************************-->

	<entity name="ActivityType" class="ActivityTypeData" metadata-complete="true">
		<description>Mapping definition for the Activity Types (Moodle modules)</description>
		<table name="mdl_modules"/>
		<named-query name="ActivityTypeData:all">
			<query>SELECT t FROM ActivityType t</query>
		</named-query>
		<attributes>
			<id name="id">
				<column name="id"/>
			</id>
			<basic name="name">
				<column name="name"/>
			</basic>
			<transient name="actions"/>
			<transient name="source"/>
		</attributes>
	</entity>

	<!--	<entity name="Activity" class="ActivityInstance" metadata-complete="true">
		<description>Mapping definition for the instances of the activities</description>
		<inheritance strategy="TABLE_PER_CLASS"/>
		<named-query name="Activity:all">
			<query>SELECT a FROM Activity a</query>
		</named-query>
		<attributes>
			<many-to-one name="course" target-entity="CourseData" optional="false">
				<join-column name="course" nullable="false" insertable="false" updatable="false"/>
			</many-to-one>
			<transient name="type"/>
			<transient name="grades"/>
			<transient name="subActivities"/>
			<transient name="log"/>
		</attributes>
	</entity>-->

	<entity name="MoodleActivity" class="ca.uoguelph.socs.icc.edm.domain.database.moodle.MoodleActivity" metadata-complete="true">
		<description>Activity mapping with moodle instance data</description>
		<table name="mdl_course_modules"/>
		<attributes>
			<id name="id">
				<column name="id" nullable="false" unique="true"/>
			</id>
			<basic name="instanceId">
				<column name="instance"/>
			</basic>
			<many-to-one name="course" target-entity="CourseData" optional="false">
				<join-column name="course" nullable="false" insertable="false" updatable="false"/>
			</many-to-one>
			<many-to-one name="type" target-entity="ActivityTypeData" optional="false">
				<join-column name="module" nullable="false" insertable="false" updatable="false"/>
			</many-to-one>
			<transient name="subActivities"/>
			<transient name="log"/>
			<transient name="name"/>
			<transient name="activity"/>
			<transient name="grades"/>
		</attributes>
	</entity>

		<!--*********************************************************************-->
	<!-- Core data mapping: Log entries                                      -->
	<!--*********************************************************************-->

	<entity name="LogEntry" class="ca.uoguelph.socs.icc.edm.domain.database.moodle.MoodleLogData" metadata-complete="true">
		<description>The course activity log</description>
		<table name="mdl_log"/>
		<named-query name="MoodleLogData:maxid">
			<query>SELECT MAX(e.id) FROM LogEntry e</query>
		</named-query>
		<named-query name="MoodleLogData:allid">
			<query>SELECT e.id FROM LogEntry e</query>
		</named-query>
		<named-query name="MoodleLogData:all">
			<query>SELECT e FROM LogEntry e</query>
		</named-query>
		<named-query name="MoodleLogData:course">
			<query>SELECT e FROM LogEntry e WHERE e.course = :course ORDER BY e.id</query>
		</named-query>
		<attributes>
			<id name="id">
				<column name="id" nullable="false" unique="true"/>
			</id>
			<basic name="time" optional="false">
				<column name="time" nullable="false"/>
				<convert converter="ca.uoguelph.socs.icc.edm.domain.database.moodle.converter.IntDateConverter"/>
			</basic>
			<basic name="actionName" optional="false">
				<column name="action" nullable="false"/>
			</basic>
			<basic name="activityId" optional="false">
				<column name="cmid" nullable="false"/>
			</basic>
			<basic name="module" optional="false">
				<column name="module" nullable="false"/>
			</basic>
			<basic name="info" optional="false">
				<column name="info" nullable="false"/>
			</basic>
			<basic name="IPAddress" optional="false">
				<column name="ip" nullable="false"/>
			</basic>
			<basic name="user" optional="false">
				<column name="userid" nullable="false"/>
			</basic>
			<many-to-one name="course" target-entity="CourseData" optional="false">
				<join-column name="course" nullable="false" referenced-column-name="id"/>
			</many-to-one>
			<transient name="action"/>
			<transient name="activity"/>
			<transient name="enrolment"/>
			<transient name="subActivity"/>
		</attributes>
	</entity>

</entity-mappings>
